{% extends 'base.html' %}
{% block title %}Trang chủ{% endblock %}
{% block extra_head %}
<style>
  /* Styles specific to the home page.  A welcoming hero section and
     feature cards summarise the key functions of the application. */
  .home-hero {
    text-align: center;
    padding: 40px 0;
    background: #f7fafc;
    border-radius: 8px;
  }
  .home-hero h2 {
    margin: 0 0 10px;
    font-size: 32px;
    color: #1f2937;
    letter-spacing: 1px;
  }
  .home-hero p {
    margin: 0;
    font-size: 16px;
    color: #4b5563;
  }
  .metrics {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 15px;
    margin-top: 30px;
  }
  .metric-card {
    flex: 1 1 220px;
    background: #ffffff;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    padding: 20px;
    text-align: center;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeUp 0.6s forwards;
  }
  /* Stagger animations for metric cards */
  .metrics .metric-card:nth-child(1) { animation-delay: 0s; }
  .metrics .metric-card:nth-child(2) { animation-delay: 0.1s; }
  .metrics .metric-card:nth-child(3) { animation-delay: 0.2s; }
  .metrics .metric-card:nth-child(4) { animation-delay: 0.3s; }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .metric-card .icon {
    font-size: 32px;
    margin-bottom: 10px;
  }
  .metric-card .value {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 4px;
  }
  .metric-card .label {
    font-size: 14px;
    color: #4b5563;
  }

  /* Gallery of thematic images below the metrics */
  .design-gallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
  }
  .design-gallery img {
    width: 280px;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    opacity: 0;
    transform: scale(0.95);
    animation: fadeInScale 0.8s forwards;
  }
  .design-gallery img:nth-child(1) { animation-delay: 0.1s; }
  .design-gallery img:nth-child(2) { animation-delay: 0.2s; }
  .design-gallery img:nth-child(3) { animation-delay: 0.3s; }
  @keyframes fadeInScale {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
</style>
{% endblock %}
{% block content %}
<div class="home-hero">
    <h2>Chào mừng bạn đến với hệ thống quản lý vi phạm</h2>
    <p>Giải pháp trực quan để theo dõi vi phạm, đóng góp quỹ và quản lý tài chính lớp học.</p>
</div>


{% if user %}
    <p>Xin chào <strong>{{ user.display_name }}</strong>!</p>
    {% if outstanding is not none %}
        {% if outstanding > 0 %}
            <p>Bạn còn nợ tổng cộng {{ format_currency(outstanding) }}. Hãy tới trang <a href="{{ url_for('pay', username=user.username) }}">Nộp tiền</a> để thanh toán.</p>
        {% endif %}
    {% else %}
        <p>Bạn chưa chọn tên học sinh của mình. Hãy vào mục <a href="{{ url_for('pay', username=user.username) }}">Nộp tiền</a> và chọn tên để liên kết với hồ sơ.</p>
    {% endif %}
    <p>Bạn có thể truy cập các chức năng từ thanh điều hướng phía trên.</p>
{% else %}
    <p>Vui lòng <a href="{{ url_for('login') }}">đăng nhập</a> hoặc <a href="{{ url_for('register') }}">đăng kí</a> để sử dụng đầy đủ chức năng.</p>
{% endif %}

<!-- Dashboard metrics -->
<div class="metrics">
    {% for m in metrics %}
    <div class="metric-card" style="border-top: 4px solid {{ m.color }};">
        <div class="icon" style="color: {{ m.color }};">{{ m.icon }}</div>
        <div class="value" style="color: {{ m.color }};">{{ m.value }}</div>
        <div class="label">{{ m.label }}</div>
    </div>
    {% endfor %}
</div>

<!-- Thematic image gallery -->
<div class="design-gallery">
  <img src="{{ url_for('static', filename='images/home1.png') }}" alt="Quản lý lớp học">
  <img src="{{ url_for('static', filename='images/home2.png') }}" alt="Thanh toán qua QR">
  <img src="{{ url_for('static', filename='images/home3.png') }}" alt="Tuân thủ quy định">
</div>

{% if chart_labels %}
<div style="margin-top:40px; max-width:700px; margin-left:auto; margin-right:auto;">
  <h3 style="text-align:center; margin-bottom:10px;">Biểu Đồ Số Lần Vi Phạm Theo Tuần</h3>
  <canvas id="violationChart" width="400" height="200"></canvas>
</div>
{% endif %}

<!-- Current week summary table -->
{% if week_summary %}
<div style="margin-top:40px; max-width:800px; margin-left:auto; margin-right:auto;">
  <h3 style="text-align:center; margin-bottom:10px;">Tổng Kết Tuần {{ current_week }}</h3>
  <table style="width:100%; border-collapse:collapse; background:#ffffff; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
    <thead>
      <tr style="background:#e1e9f6;">
        <th style="padding:8px; border:1px solid #e5e7eb;">Họ và Tên</th>
        <th style="padding:8px; border:1px solid #e5e7eb;">Số Lần Vi Phạm</th>
        <th style="padding:8px; border:1px solid #e5e7eb;">Còn Lại</th>
        <th style="padding:8px; border:1px solid #e5e7eb;">Xem Chi Tiết</th>
      </tr>
    </thead>
    <tbody>
      {% for row in week_summary %}
      <tr style="background:{% if loop.index0 % 2 == 0 %}#fafafa{% else %}#ffffff{% endif %};">
        <td style="padding:8px; border:1px solid #e5e7eb;">{{ row.student }}</td>
        <td style="padding:8px; border:1px solid #e5e7eb; text-align:center;">{{ row.count }}</td>
        <td style="padding:8px; border:1px solid #e5e7eb; text-align:center;">{{ format_currency(row.outstanding) }}</td>
        <td style="padding:8px; border:1px solid #e5e7eb; text-align:center;">
          <a href="{{ url_for('summary', week=current_week, student=row.student) }}" style="color:#2563eb;">Chi tiết</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock %}
{% block extra_scripts %}
{{ super() }}
{% if chart_labels %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('violationChart').getContext('2d');
  const labels = {{ chart_labels | safe }};
  const dataPoints = {{ chart_values | safe }};
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Số lần vi phạm',
        data: dataPoints,
        backgroundColor: 'rgba(59, 130, 246, 0.5)',
        borderColor: 'rgba(59, 130, 246, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        x: {
          title: {
            display: true,
            text: 'Tuần'
          }
        },
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Lần vi phạm'
          }
        }
      }
    }
  });
</script>
{% endif %}
{% endblock %}