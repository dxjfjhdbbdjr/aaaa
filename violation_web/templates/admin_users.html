{% extends 'base.html' %}
{% block title %}Quản Lí User{% endblock %}
{% block extra_head %}
<style>
  .user-table {
    width: 100%;
    border-collapse: collapse;
    background: #ffffff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .user-table th, .user-table td {
    border: 1px solid #e5e7eb;
    padding: 8px;
    text-align: left;
  }
  .user-table th {
    background: #f1f5f9;
    font-weight: 600;
  }
  .user-table tbody tr:nth-child(odd) {
    background-color: #fafafa;
  }
  .user-table tbody tr:hover {
    background-color: #f3f4f6;
  }
  .actions form {
    display: inline;
  }
  .btn-action {
    background: #2563eb;
    color: #fff;
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin-right: 4px;
  }
  .btn-delete {
    background: #dc2626;
  }
</style>
{% endblock %}
{% block content %}
<h2 style="margin-bottom: 10px; font-size: 22px; font-weight: 600;">Quản Lí Người Dùng</h2>
<p>Danh sách tất cả tài khoản. Bạn có thể cấp hoặc thu hồi quyền quản trị và xóa tài khoản (trừ tài khoản của bạn).</p>
<table class="user-table">
  <thead>
    <tr>
      <th>STT</th>
      <th>Tên Hiển Thị</th>
      <th>Tên Đăng Nhập</th>
      <th>Email</th>
      <th>Vai Trò</th>
      <th>Ngày Tạo</th>
      <th>Hành Động</th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ u.display_name }}</td>
      <td>{{ u.username }}</td>
      <td>{{ u.email }}</td>
      <td>{{ 'Admin' if u.is_admin else 'Học Sinh' }}</td>
      <td>{{ u.registered_at.strftime('%d/%m/%Y') }}</td>
      <td class="actions">
        {% if u.id != user.id %}
        <form method="post" style="display:inline;">
          <input type="hidden" name="action" value="toggle_admin">
          <input type="hidden" name="user_id" value="{{ u.id }}">
          <button type="submit" class="btn-action">
            {% if u.is_admin %}Thu quyền Admin{% else %}Cấp quyền Admin{% endif %}
          </button>
        </form>
        <form method="post" style="display:inline;" onsubmit="return confirm('Bạn có chắc muốn xóa tài khoản này?');">
          <input type="hidden" name="action" value="delete">
          <input type="hidden" name="user_id" value="{{ u.id }}">
          <button type="submit" class="btn-action btn-delete">Xóa</button>
        </form>
        {% else %}
        (Bạn)
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}